<form [formGroup]="unitForm" *ngIf="unitForm">
  <vgr-panel-container>

    <vgr-panel [width]="6" [noborder]="true">
      <div *ngIf="showId">
        <div>ID:</div>
        <vgr-input formControlName="id"></vgr-input>
      </div>
      <div>
        <div>Namn:</div>
        <vgr-input formControlName="name"></vgr-input>
      </div>
    </vgr-panel>

    <vgr-panel [width]="6" [noborder]="true">

      <div>Klinik:</div>

      <vgr-dropdown [items]="clinicDropdownItems" formControlName="clinic"></vgr-dropdown>

    </vgr-panel>

  </vgr-panel-container>

  <vgr-card>
    <vgr-card-column>
      <vgr-card-section [expanded]="true" [title]="'Funktionsval'" [readonly]="false">
        <vgr-title-value-layout>
          <vgr-checkbox label="Gick hem" formControlName="hasLeftDateFeature"></vgr-checkbox>
          <vgr-checkbox label="Vårdplan" formControlName="hasCarePlan"></vgr-checkbox>
          <vgr-checkbox label="Akut patient" formControlName="hasAkutPatientFeature"></vgr-checkbox>
        </vgr-title-value-layout>
      </vgr-card-section>
    </vgr-card-column>

    <vgr-card-column>
      <vgr-card-section [expanded]="true" [title]="'Vårdlag'" [subtitle]="" class="clearfix">
        <table class="vpp-table" *ngIf="!editSsks">

          <tr *ngFor="let ssk of unit?.ssks || []">
            <td>{{ssk.label}}</td>
            <td><span class="ssk-color ssk-{{ssk.color}}"></span></td>
          </tr>

          <tfoot>
          <tr>
            <td><a (click)="editSsks = true;" class="icon-link icon-link-with-text"><span class="material-icons">edit</span><span class="icon-text">Redigera</span></a></td></tr>
          </tfoot>
        </table>

        <div *ngIf="editSsks">
          <div formArrayName="ssks" *ngFor="let ssk of unitForm?.get('ssks').controls; let i = index;" class="edit-ssk-row">
            <div [formGroupName]="i">
              <input formControlName="label" placeholder="Namn..."/>
              <vgr-dropdown [items]="[{displayName: 'Blå', value: 'BLUE'}, {displayName: 'Grön', value: 'GREEN'}, {displayName: 'Röd', value: 'RED'}]" formControlName="color"></vgr-dropdown>
              <a (click)="deleteSsk(i)" class="icon-link"><span class="material-icons">delete</span></a>
            </div>
          </div>
          <div>
            <a (click)="addSsk()" class="icon-link icon-link-with-text"><span class="add-row vgr-icon-plus"></span><span class="icon-text">Lägg till vårdlag</span></a>
          </div>
        </div>
      </vgr-card-section>

      <vgr-card-section [expanded]="true" [title]="'Ursprungs kliniker'" [subtitle]="" class="clearfix">
        <table class="vpp-table" *ngIf="!editKlinik">

          <tr *ngFor="let klinik of unit?.servingClinics || []">
            <td>{{klinik.name}}</td>
          </tr>

          <tfoot>
          <tr>
            <td><a (click)="editKlinik = true;" class="icon-link icon-link-with-text"><span class="material-icons">edit</span><span class="icon-text">Redigera</span></a></td></tr>
          </tfoot>
        </table>

        <div *ngIf="editKlinik">
          <div formArrayName="servingClinics" *ngFor="let klinik of servingClinics.controls let i = index;" class="edit-ssk-row">
            <div [formGroupName]="i">
              <input formControlName="name" placeholder="Klinik..."/>
              <a (click)="deleteServingClinic(i)" class="icon-link"><span class="material-icons">delete</span></a>
            </div>
          </div>
          <div>
            <a (click)="addServingClinic()" class="icon-link icon-link-with-text"><span class="add-row vgr-icon-plus"></span><span class="icon-text">Lägg till upsprungs klinik</span></a>
          </div>
        </div>
      </vgr-card-section>
    </vgr-card-column>
  </vgr-card>

  <vgr-save-cancel (save)="saveUnit()" (cancel)="cancel()"
                   [hideLock]="true"></vgr-save-cancel>
</form>

<!--<vgr-page-block>
      <pre>{{unitForm?.value | json}}</pre>
    </vgr-page-block>-->
